<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlueSync - BLE Time Sync for Zephyr: src/local_time.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BlueSync - BLE Time Sync for Zephyr
   </div>
   <div id="projectbrief">High-precision time synchronization for BLE Mesh networks</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('local__time_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">local_time.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for local_time.h:</div>
<div class="dyncontent">
<div class="center"><img src="local__time_8h__incl.png" border="0" usemap="#asrc_2local__time_8h" alt=""/></div>
<map name="asrc_2local__time_8h" id="asrc_2local__time_8h">
<area shape="rect" title=" " alt="" coords="5,5,131,31"/>
<area shape="rect" title=" " alt="" coords="33,79,103,104"/>
<area shape="poly" title=" " alt="" coords="71,31,71,65,65,65,65,31"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="local__time_8h__dep__incl.png" border="0" usemap="#asrc_2local__time_8hdep" alt=""/></div>
<map name="asrc_2local__time_8hdep" id="asrc_2local__time_8hdep">
<area shape="rect" title=" " alt="" coords="5,5,131,31"/>
<area shape="rect" href="bluesync_8c.html" title=" " alt="" coords="11,79,125,104"/>
<area shape="poly" title=" " alt="" coords="71,44,71,79,65,79,65,44"/>
</map>
</div>
</div>
<p><a href="local__time_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a861e026d9803cb168d2a764f73ed9801" id="r_a861e026d9803cb168d2a764f73ed9801"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="local__time_8h.html#a861e026d9803cb168d2a764f73ed9801">get_logical_time_us</a> (void)</td></tr>
<tr class="memdesc:a861e026d9803cb168d2a764f73ed9801"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the logical time us value. This is the corrected us value after synchronisation. This represents the unix epoch timestamp in us of the overall mesh network. Basically, it converts logical ticks into us.  <br /></td></tr>
<tr class="separator:a861e026d9803cb168d2a764f73ed9801"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5017299371e5f5ef9d74e7dbc0700e09" id="r_a5017299371e5f5ef9d74e7dbc0700e09"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="local__time_8h.html#a5017299371e5f5ef9d74e7dbc0700e09">get_logical_time_ticks</a> (void)</td></tr>
<tr class="memdesc:a5017299371e5f5ef9d74e7dbc0700e09"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the logical time ticks value. This is the corrected ticks value after synchronisation. This represents the unix epoch timestamp in ticks of the overall mesh network.  <br /></td></tr>
<tr class="separator:a5017299371e5f5ef9d74e7dbc0700e09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04bc6c6b4c6fc0965d0a2ef58cfb87c0" id="r_a04bc6c6b4c6fc0965d0a2ef58cfb87c0"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="local__time_8h.html#a04bc6c6b4c6fc0965d0a2ef58cfb87c0">convert_uptime_ticks_to_est_master_ticks</a> (uint64_t uptime_ticks)</td></tr>
<tr class="memdesc:a04bc6c6b4c6fc0965d0a2ef58cfb87c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a ticks value into an estimation in ticks of the overall unix epoch timestamp.  <br /></td></tr>
<tr class="separator:a04bc6c6b4c6fc0965d0a2ef58cfb87c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdf341f92b5683216748687f6e66eb2a" id="r_afdf341f92b5683216748687f6e66eb2a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="local__time_8h.html#afdf341f92b5683216748687f6e66eb2a">get_current_slope_ticks</a> ()</td></tr>
<tr class="memdesc:afdf341f92b5683216748687f6e66eb2a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current slope ticks value.  <br /></td></tr>
<tr class="separator:afdf341f92b5683216748687f6e66eb2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5007fd4852274558e1ca59084e09a24e" id="r_a5007fd4852274558e1ca59084e09a24e"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="local__time_8h.html#a5007fd4852274558e1ca59084e09a24e">get_current_offset_ticks</a> ()</td></tr>
<tr class="memdesc:a5007fd4852274558e1ca59084e09a24e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current offset ticks value.  <br /></td></tr>
<tr class="separator:a5007fd4852274558e1ca59084e09a24e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ff48ea951750b142b77d3290b1fefa0" id="r_a4ff48ea951750b142b77d3290b1fefa0"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="local__time_8h.html#a4ff48ea951750b142b77d3290b1fefa0">get_uptime_ticks_with_epoch</a> ()</td></tr>
<tr class="memdesc:a4ff48ea951750b142b77d3290b1fefa0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the uptime ticks with epoch value. This method concerns only the authority Role. This method will return the unix epoch timestamp based on the elapsed time (uptime - ref) and add the overall reference.  <br /></td></tr>
<tr class="separator:a4ff48ea951750b142b77d3290b1fefa0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a129e568095d5d38c8bff447987d28132" id="r_a129e568095d5d38c8bff447987d28132"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="local__time_8h.html#a129e568095d5d38c8bff447987d28132">set_new_epoch_unix_ref</a> (uint64_t epoch_ref_us)</td></tr>
<tr class="memdesc:a129e568095d5d38c8bff447987d28132"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the new epoch unix ref value. Before the authority node starts a new network synchronisation, it should update the epoch reference.  <br /></td></tr>
<tr class="separator:a129e568095d5d38c8bff447987d28132"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02d7d859f35cfa3d60922cabb98216e1" id="r_a02d7d859f35cfa3d60922cabb98216e1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="local__time_8h.html#a02d7d859f35cfa3d60922cabb98216e1">apply_timer_sync</a> (double slope_timer, double offset_timer_us)</td></tr>
<tr class="memdesc:a02d7d859f35cfa3d60922cabb98216e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply the synchronisation parameters. Once the LR is made, The result of it gives a drift value (slope) and the difference between itself and the reference (offset). This method permits to set these parameters in order to have the proper correction when getting timestamps values.  <br /></td></tr>
<tr class="separator:a02d7d859f35cfa3d60922cabb98216e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e5e7f4f074a146369ffa41864b51293" id="r_a1e5e7f4f074a146369ffa41864b51293"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="local__time_8h.html#a1e5e7f4f074a146369ffa41864b51293">uncompress_time</a> (uint32_t compress_32bit_timestamp)</td></tr>
<tr class="memdesc:a1e5e7f4f074a146369ffa41864b51293"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a uint32_t timestamps into a uint64_t values. This should be used in the sink node. In the Mesh network, pakcet payload is limited. Therefore only uint32_t timestamp can be used. When the sink received this kind of value, it can reconstruct the correct timestamps value.  <br /></td></tr>
<tr class="separator:a1e5e7f4f074a146369ffa41864b51293"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a02d7d859f35cfa3d60922cabb98216e1" name="a02d7d859f35cfa3d60922cabb98216e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02d7d859f35cfa3d60922cabb98216e1">&#9670;&#160;</a></span>apply_timer_sync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_timer_sync </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>slope_timer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>offset_timer_us</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Apply the synchronisation parameters. Once the LR is made, The result of it gives a drift value (slope) and the difference between itself and the reference (offset). This method permits to set these parameters in order to have the proper correction when getting timestamps values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">slope_timer</td><td></td></tr>
    <tr><td class="paramname">offset_timer_us</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00101">101</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>

</div>
</div>
<a id="a04bc6c6b4c6fc0965d0a2ef58cfb87c0" name="a04bc6c6b4c6fc0965d0a2ef58cfb87c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04bc6c6b4c6fc0965d0a2ef58cfb87c0">&#9670;&#160;</a></span>convert_uptime_ticks_to_est_master_ticks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t convert_uptime_ticks_to_est_master_ticks </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>uptime_ticks</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a ticks value into an estimation in ticks of the overall unix epoch timestamp. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">uptime_ticks</td><td>: value that should be concerted </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint64_t </dd></dl>

</div>
</div>
<a id="a5007fd4852274558e1ca59084e09a24e" name="a5007fd4852274558e1ca59084e09a24e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5007fd4852274558e1ca59084e09a24e">&#9670;&#160;</a></span>get_current_offset_ticks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_current_offset_ticks </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current offset ticks value. </p>
<dl class="section return"><dt>Returns</dt><dd>double </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00159">159</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>

</div>
</div>
<a id="afdf341f92b5683216748687f6e66eb2a" name="afdf341f92b5683216748687f6e66eb2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdf341f92b5683216748687f6e66eb2a">&#9670;&#160;</a></span>get_current_slope_ticks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_current_slope_ticks </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current slope ticks value. </p>
<dl class="section return"><dt>Returns</dt><dd>double </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00155">155</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>

</div>
</div>
<a id="a5017299371e5f5ef9d74e7dbc0700e09" name="a5017299371e5f5ef9d74e7dbc0700e09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5017299371e5f5ef9d74e7dbc0700e09">&#9670;&#160;</a></span>get_logical_time_ticks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t get_logical_time_ticks </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the logical time ticks value. This is the corrected ticks value after synchronisation. This represents the unix epoch timestamp in ticks of the overall mesh network. </p>
<dl class="section return"><dt>Returns</dt><dd>uint64_t </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00097">97</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>

</div>
</div>
<a id="a861e026d9803cb168d2a764f73ed9801" name="a861e026d9803cb168d2a764f73ed9801"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a861e026d9803cb168d2a764f73ed9801">&#9670;&#160;</a></span>get_logical_time_us()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t get_logical_time_us </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the logical time us value. This is the corrected us value after synchronisation. This represents the unix epoch timestamp in us of the overall mesh network. Basically, it converts logical ticks into us. </p>
<dl class="section return"><dt>Returns</dt><dd>uint64_t </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00092">92</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>

</div>
</div>
<a id="a4ff48ea951750b142b77d3290b1fefa0" name="a4ff48ea951750b142b77d3290b1fefa0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ff48ea951750b142b77d3290b1fefa0">&#9670;&#160;</a></span>get_uptime_ticks_with_epoch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t get_uptime_ticks_with_epoch </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the uptime ticks with epoch value. This method concerns only the authority Role. This method will return the unix epoch timestamp based on the elapsed time (uptime - ref) and add the overall reference. </p>
<dl class="section return"><dt>Returns</dt><dd>int64_t </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00143">143</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>

</div>
</div>
<a id="a129e568095d5d38c8bff447987d28132" name="a129e568095d5d38c8bff447987d28132"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a129e568095d5d38c8bff447987d28132">&#9670;&#160;</a></span>set_new_epoch_unix_ref()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_new_epoch_unix_ref </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>epoch_ref_us</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the new epoch unix ref value. Before the authority node starts a new network synchronisation, it should update the epoch reference. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">epoch_ref_ms</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00112">112</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>

</div>
</div>
<a id="a1e5e7f4f074a146369ffa41864b51293" name="a1e5e7f4f074a146369ffa41864b51293"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e5e7f4f074a146369ffa41864b51293">&#9670;&#160;</a></span>uncompress_time()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t uncompress_time </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>compress_32bit_timestamp</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a uint32_t timestamps into a uint64_t values. This should be used in the sink node. In the Mesh network, pakcet payload is limited. Therefore only uint32_t timestamp can be used. When the sink received this kind of value, it can reconstruct the correct timestamps value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">compress_32bit_timestamp</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint64_t </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00163">163</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="local__time_8h.html">local_time.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
