<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bluesync in BLE Mesh: src/local_time.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Bluesync in BLE Mesh<span id="projectnumber">&#160;1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">local_time.h File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for local_time.h:</div>
<div class="dyncontent">
<div class="center"><img src="local__time_8h__incl.png" border="0" usemap="#asrc_2local__time_8h" alt=""/></div>
<map name="asrc_2local__time_8h" id="asrc_2local__time_8h">
<area shape="rect" title=" " alt="" coords="5,5,118,31"/>
<area shape="rect" title=" " alt="" coords="30,79,93,105"/>
<area shape="poly" title=" " alt="" coords="64,31,64,63,59,63,59,31"/>
</map>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><img src="local__time_8h__dep__incl.png" border="0" usemap="#asrc_2local__time_8hdep" alt=""/></div>
<map name="asrc_2local__time_8hdep" id="asrc_2local__time_8hdep">
<area shape="rect" title=" " alt="" coords="5,5,118,31"/>
<area shape="rect" href="bluesync_8c.html" title=" " alt="" coords="9,79,114,105"/>
<area shape="poly" title=" " alt="" coords="64,46,64,79,59,79,59,46"/>
</map>
</div>
</div>
<p><a href="local__time_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a861e026d9803cb168d2a764f73ed9801" id="r_a861e026d9803cb168d2a764f73ed9801"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a861e026d9803cb168d2a764f73ed9801">get_logical_time_us</a> (void)</td></tr>
<tr class="memdesc:a861e026d9803cb168d2a764f73ed9801"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the logical time us value. This is the corrected us value after synchronisation. This represents the unix epoch timestamp in us of the overall mesh network. Basically, it converts logical ticks into us.  <br /></td></tr>
<tr class="separator:a861e026d9803cb168d2a764f73ed9801"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5017299371e5f5ef9d74e7dbc0700e09" id="r_a5017299371e5f5ef9d74e7dbc0700e09"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5017299371e5f5ef9d74e7dbc0700e09">get_logical_time_ticks</a> (void)</td></tr>
<tr class="memdesc:a5017299371e5f5ef9d74e7dbc0700e09"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the logical time ticks value. This is the corrected ticks value after synchronisation. This represents the unix epoch timestamp in ticks of the overall mesh network.  <br /></td></tr>
<tr class="separator:a5017299371e5f5ef9d74e7dbc0700e09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04bc6c6b4c6fc0965d0a2ef58cfb87c0" id="r_a04bc6c6b4c6fc0965d0a2ef58cfb87c0"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a04bc6c6b4c6fc0965d0a2ef58cfb87c0">convert_uptime_ticks_to_est_master_ticks</a> (uint64_t uptime_ticks)</td></tr>
<tr class="memdesc:a04bc6c6b4c6fc0965d0a2ef58cfb87c0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a ticks value into an estimation in ticks of the overall unix epoch timestamp.  <br /></td></tr>
<tr class="separator:a04bc6c6b4c6fc0965d0a2ef58cfb87c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdf341f92b5683216748687f6e66eb2a" id="r_afdf341f92b5683216748687f6e66eb2a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afdf341f92b5683216748687f6e66eb2a">get_current_slope_ticks</a> ()</td></tr>
<tr class="memdesc:afdf341f92b5683216748687f6e66eb2a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current slope ticks value.  <br /></td></tr>
<tr class="separator:afdf341f92b5683216748687f6e66eb2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5007fd4852274558e1ca59084e09a24e" id="r_a5007fd4852274558e1ca59084e09a24e"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5007fd4852274558e1ca59084e09a24e">get_current_offset_ticks</a> ()</td></tr>
<tr class="memdesc:a5007fd4852274558e1ca59084e09a24e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current offset ticks value.  <br /></td></tr>
<tr class="separator:a5007fd4852274558e1ca59084e09a24e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ff48ea951750b142b77d3290b1fefa0" id="r_a4ff48ea951750b142b77d3290b1fefa0"><td class="memItemLeft" align="right" valign="top">int64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4ff48ea951750b142b77d3290b1fefa0">get_uptime_ticks_with_epoch</a> ()</td></tr>
<tr class="memdesc:a4ff48ea951750b142b77d3290b1fefa0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the uptime ticks with epoch value. This method concerns only the authority Role. This method will return the unix epoch timestamp based on the elapsed time (uptime - ref) and add the overall reference.  <br /></td></tr>
<tr class="separator:a4ff48ea951750b142b77d3290b1fefa0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a129e568095d5d38c8bff447987d28132" id="r_a129e568095d5d38c8bff447987d28132"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a129e568095d5d38c8bff447987d28132">set_new_epoch_unix_ref</a> (uint64_t epoch_ref_us)</td></tr>
<tr class="memdesc:a129e568095d5d38c8bff447987d28132"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the new epoch unix ref value. Before the authority node starts a new network synchronisation, it should update the epoch reference.  <br /></td></tr>
<tr class="separator:a129e568095d5d38c8bff447987d28132"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02d7d859f35cfa3d60922cabb98216e1" id="r_a02d7d859f35cfa3d60922cabb98216e1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a02d7d859f35cfa3d60922cabb98216e1">apply_timer_sync</a> (double slope_timer, double offset_timer_us)</td></tr>
<tr class="memdesc:a02d7d859f35cfa3d60922cabb98216e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply the synchronisation parameters. Once the LR is made, The result of it gives a drift value (slope) and the difference between itself and the reference (offset). This method permits to set these parameters in order to have the proper correction when getting timestamps values.  <br /></td></tr>
<tr class="separator:a02d7d859f35cfa3d60922cabb98216e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e5e7f4f074a146369ffa41864b51293" id="r_a1e5e7f4f074a146369ffa41864b51293"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1e5e7f4f074a146369ffa41864b51293">uncompress_time</a> (uint32_t compress_32bit_timestamp)</td></tr>
<tr class="memdesc:a1e5e7f4f074a146369ffa41864b51293"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert a uint32_t timestamps into a uint64_t values. This should be used in the sink node. In the Mesh network, pakcet payload is limited. Therefore only uint32_t timestamp can be used. When the sink received this kind of value, it can reconstruct the correct timestamps value.  <br /></td></tr>
<tr class="separator:a1e5e7f4f074a146369ffa41864b51293"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="a02d7d859f35cfa3d60922cabb98216e1" name="a02d7d859f35cfa3d60922cabb98216e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02d7d859f35cfa3d60922cabb98216e1">&#9670;&#160;</a></span>apply_timer_sync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apply_timer_sync </td>
          <td>(</td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>slope_timer</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>offset_timer_us</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Apply the synchronisation parameters. Once the LR is made, The result of it gives a drift value (slope) and the difference between itself and the reference (offset). This method permits to set these parameters in order to have the proper correction when getting timestamps values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">slope_timer</td><td></td></tr>
    <tr><td class="paramname">offset_timer_us</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00101">101</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  101</span>                                                           {</div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>    k_mutex_lock(&amp;<a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.mutex, K_FOREVER);</div>
<div class="line"><span class="lineno">  104</span>    {</div>
<div class="line"><span class="lineno">  105</span>        <a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.curent_slope_ticks = new_slope;</div>
<div class="line"><span class="lineno">  106</span>        <a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.curent_offset_ticks = new_offset;</div>
<div class="line"><span class="lineno">  107</span>    }</div>
<div class="line"><span class="lineno">  108</span>    k_mutex_unlock(&amp;<a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.mutex);</div>
<div class="line"><span class="lineno">  109</span>}</div>
<div class="ttc" id="alocal__time_8c_html_aebe0d3778275cefebe36f5d35011bd93"><div class="ttname"><a href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a></div><div class="ttdeci">static struct local_time local</div><div class="ttdef"><b>Definition</b> <a href="local__time_8c_source.html#l00053">local_time.c:53</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.</p>

<p class="reference">Referenced by <a class="el" href="bluesync_8c.html#aeca8c130ac37b793356125ef9ceebc22">end_sync_timeslot_process()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="local__time_8h_a02d7d859f35cfa3d60922cabb98216e1_icgraph.png" border="0" usemap="#alocal__time_8h_a02d7d859f35cfa3d60922cabb98216e1_icgraph" alt=""/></div>
<map name="alocal__time_8h_a02d7d859f35cfa3d60922cabb98216e1_icgraph" id="alocal__time_8h_a02d7d859f35cfa3d60922cabb98216e1_icgraph">
<area shape="rect" title="Apply the synchronisation parameters. Once the LR is made, The result of it gives a drift value (slop..." alt="" coords="414,5,535,31"/>
<area shape="rect" href="bluesync_8c.html#aeca8c130ac37b793356125ef9ceebc22" title=" " alt="" coords="184,5,366,31"/>
<area shape="poly" title=" " alt="" coords="399,21,367,21,367,16,399,16"/>
<area shape="rect" href="bluesync_8c.html#a5e07e4c09110ee0eb81c51b0551a3101" title=" " alt="" coords="5,5,136,31"/>
<area shape="poly" title=" " alt="" coords="168,21,136,21,136,16,168,16"/>
</map>
</div>

</div>
</div>
<a id="a04bc6c6b4c6fc0965d0a2ef58cfb87c0" name="a04bc6c6b4c6fc0965d0a2ef58cfb87c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04bc6c6b4c6fc0965d0a2ef58cfb87c0">&#9670;&#160;</a></span>convert_uptime_ticks_to_est_master_ticks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t convert_uptime_ticks_to_est_master_ticks </td>
          <td>(</td>
          <td class="paramtype">uint64_t</td>          <td class="paramname"><span class="paramname"><em>uptime_ticks</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a ticks value into an estimation in ticks of the overall unix epoch timestamp. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">uptime_ticks</td><td>: value that should be concerted </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint64_t </dd></dl>

</div>
</div>
<a id="a5007fd4852274558e1ca59084e09a24e" name="a5007fd4852274558e1ca59084e09a24e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5007fd4852274558e1ca59084e09a24e">&#9670;&#160;</a></span>get_current_offset_ticks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_current_offset_ticks </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current offset ticks value. </p>
<dl class="section return"><dt>Returns</dt><dd>double </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00159">159</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  159</span>                                 {</div>
<div class="line"><span class="lineno">  160</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.curent_offset_ticks;</div>
<div class="line"><span class="lineno">  161</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.</p>

</div>
</div>
<a id="afdf341f92b5683216748687f6e66eb2a" name="afdf341f92b5683216748687f6e66eb2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdf341f92b5683216748687f6e66eb2a">&#9670;&#160;</a></span>get_current_slope_ticks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double get_current_slope_ticks </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the current slope ticks value. </p>
<dl class="section return"><dt>Returns</dt><dd>double </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00155">155</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  155</span>                                {</div>
<div class="line"><span class="lineno">  156</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.curent_slope_ticks;</div>
<div class="line"><span class="lineno">  157</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.</p>

</div>
</div>
<a id="a5017299371e5f5ef9d74e7dbc0700e09" name="a5017299371e5f5ef9d74e7dbc0700e09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5017299371e5f5ef9d74e7dbc0700e09">&#9670;&#160;</a></span>get_logical_time_ticks()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t get_logical_time_ticks </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the logical time ticks value. This is the corrected ticks value after synchronisation. This represents the unix epoch timestamp in ticks of the overall mesh network. </p>
<dl class="section return"><dt>Returns</dt><dd>uint64_t </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00097">97</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   97</span>                                  {</div>
<div class="line"><span class="lineno">   98</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="local__time_8c.html#a3de0db4d23103b2a5c83f9b27b39cf85">get_logical_time_ticks_</a>(-1);</div>
<div class="line"><span class="lineno">   99</span>}</div>
<div class="ttc" id="alocal__time_8c_html_a3de0db4d23103b2a5c83f9b27b39cf85"><div class="ttname"><a href="local__time_8c.html#a3de0db4d23103b2a5c83f9b27b39cf85">get_logical_time_ticks_</a></div><div class="ttdeci">uint64_t get_logical_time_ticks_(int64_t uptime_ticks)</div><div class="ttdef"><b>Definition</b> <a href="local__time_8c_source.html#l00062">local_time.c:62</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="local__time_8c.html#a3de0db4d23103b2a5c83f9b27b39cf85">get_logical_time_ticks_()</a>.</p>

<p class="reference">Referenced by <a class="el" href="bluesync_8c.html#a53cf47753502eeef3bd5a7e9753dc877">adv_sent_cb()</a>, <a class="el" href="bluesync_8c.html#ac1f14e07918b159fe1dc8277a7d2c14e">bluesync_decode_msg()</a>, and <a class="el" href="include_2bluesync_2bluesync_8h.html#a120ece7e147c0a90b3b973645f49af53">get_current_unix_time_us()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="local__time_8h_a5017299371e5f5ef9d74e7dbc0700e09_cgraph.png" border="0" usemap="#alocal__time_8h_a5017299371e5f5ef9d74e7dbc0700e09_cgraph" alt=""/></div>
<map name="alocal__time_8h_a5017299371e5f5ef9d74e7dbc0700e09_cgraph" id="alocal__time_8h_a5017299371e5f5ef9d74e7dbc0700e09_cgraph">
<area shape="rect" title="Get the logical time ticks value. This is the corrected ticks value after synchronisation...." alt="" coords="5,5,156,31"/>
<area shape="rect" href="local__time_8c.html#a3de0db4d23103b2a5c83f9b27b39cf85" title=" " alt="" coords="204,5,361,31"/>
<area shape="poly" title=" " alt="" coords="156,16,188,16,188,21,156,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="local__time_8h_a5017299371e5f5ef9d74e7dbc0700e09_icgraph.png" border="0" usemap="#alocal__time_8h_a5017299371e5f5ef9d74e7dbc0700e09_icgraph" alt=""/></div>
<map name="alocal__time_8h_a5017299371e5f5ef9d74e7dbc0700e09_icgraph" id="alocal__time_8h_a5017299371e5f5ef9d74e7dbc0700e09_icgraph">
<area shape="rect" title="Get the logical time ticks value. This is the corrected ticks value after synchronisation...." alt="" coords="1167,55,1318,80"/>
<area shape="rect" href="bluesync_8c.html#a53cf47753502eeef3bd5a7e9753dc877" title=" " alt="" coords="987,5,1082,31"/>
<area shape="poly" title=" " alt="" coords="1170,53,1082,32,1084,27,1171,48"/>
<area shape="rect" href="bluesync_8c.html#ac1f14e07918b159fe1dc8277a7d2c14e" title=" " alt="" coords="958,55,1111,80"/>
<area shape="poly" title=" " alt="" coords="1152,70,1112,70,1112,65,1152,65"/>
<area shape="rect" href="local__time_8c.html#a120ece7e147c0a90b3b973645f49af53" title="Get the current time which is based on the UNIX reference." alt="" coords="950,104,1119,130"/>
<area shape="poly" title=" " alt="" coords="1171,87,1093,106,1091,101,1170,82"/>
<area shape="rect" href="bluesync_8c.html#a5786970c5cd6649e57c988641e21c92b" title=" " alt="" coords="806,55,876,80"/>
<area shape="poly" title=" " alt="" coords="943,70,876,70,876,65,943,65"/>
<area shape="rect" href="bluesync_8c.html#a3281e1132ea7be337932f349e4dd0103" title=" " alt="" coords="380,25,520,51"/>
<area shape="poly" title=" " alt="" coords="790,56,731,45,621,37,521,38,521,32,621,32,732,40,791,51"/>
<area shape="rect" href="bluesync_8c.html#accff9034edc5962a24e70e68901a3ca8" title=" " alt="" coords="611,55,699,80"/>
<area shape="poly" title=" " alt="" coords="790,70,700,70,700,65,790,65"/>
<area shape="rect" href="bluesync_8c.html#a0899d4461371eab18cec52ab2673600a" title=" " alt="" coords="165,18,322,58"/>
<area shape="poly" title=" " alt="" coords="365,41,322,41,322,36,365,36"/>
<area shape="poly" title=" " alt="" coords="595,62,520,51,521,46,596,56"/>
<area shape="rect" href="synced__time__logger_8c.html#a11d39f39b2a46eb250ca0b7b7e437748" title=" " alt="" coords="780,104,902,130"/>
<area shape="poly" title=" " alt="" coords="934,120,902,120,902,114,934,114"/>
<area shape="rect" href="synced__time__logger_8c.html#ac60256ce352f8d3246b112015b649df1" title=" " alt="" coords="578,104,732,130"/>
<area shape="poly" title=" " alt="" coords="764,120,732,120,732,114,764,114"/>
<area shape="rect" href="synced__time__logger_8c.html#ab86379527d06d3811d91761b6ae57c5c" title="Initialize the timer that store regularly timestamp of the node." alt="" coords="370,104,530,130"/>
<area shape="poly" title=" " alt="" coords="562,120,531,120,531,114,562,114"/>
<area shape="rect" href="bluesync__statistic__bsim_8c.html#a931beb01090abe8ce0977b7c372647fa" title="Initialize the BlueSync statistics module." alt="" coords="169,104,318,130"/>
<area shape="poly" title=" " alt="" coords="355,120,318,120,318,114,355,114"/>
<area shape="rect" href="bluesync__statistic__bsim_8c.html#a99077ac5ea85d459dc83388437f6ccd3" title=" " alt="" coords="5,104,117,130"/>
<area shape="poly" title=" " alt="" coords="153,120,117,120,117,114,153,114"/>
</map>
</div>

</div>
</div>
<a id="a861e026d9803cb168d2a764f73ed9801" name="a861e026d9803cb168d2a764f73ed9801"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a861e026d9803cb168d2a764f73ed9801">&#9670;&#160;</a></span>get_logical_time_us()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t get_logical_time_us </td>
          <td>(</td>
          <td class="paramtype">void</td>          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the logical time us value. This is the corrected us value after synchronisation. This represents the unix epoch timestamp in us of the overall mesh network. Basically, it converts logical ticks into us. </p>
<dl class="section return"><dt>Returns</dt><dd>uint64_t </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00092">92</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   92</span>                                   {</div>
<div class="line"><span class="lineno">   93</span>    uint64_t logical_ticks = <a class="code hl_function" href="local__time_8c.html#a3de0db4d23103b2a5c83f9b27b39cf85">get_logical_time_ticks_</a>(-1);</div>
<div class="line"><span class="lineno">   94</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="local__time_8c.html#aa2d01a129ee41f0c1114b32b95b5647b">ticks_to_us</a>(logical_ticks);</div>
<div class="line"><span class="lineno">   95</span>}</div>
<div class="ttc" id="alocal__time_8c_html_aa2d01a129ee41f0c1114b32b95b5647b"><div class="ttname"><a href="local__time_8c.html#aa2d01a129ee41f0c1114b32b95b5647b">ticks_to_us</a></div><div class="ttdeci">#define ticks_to_us(ticks)</div><div class="ttdef"><b>Definition</b> <a href="local__time_8c_source.html#l00037">local_time.c:37</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="local__time_8c.html#a3de0db4d23103b2a5c83f9b27b39cf85">get_logical_time_ticks_()</a>, and <a class="el" href="local__time_8c.html#aa2d01a129ee41f0c1114b32b95b5647b">ticks_to_us</a>.</p>

<p class="reference">Referenced by <a class="el" href="local__time_8c.html#a1e5e7f4f074a146369ffa41864b51293">uncompress_time()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="local__time_8h_a861e026d9803cb168d2a764f73ed9801_cgraph.png" border="0" usemap="#alocal__time_8h_a861e026d9803cb168d2a764f73ed9801_cgraph" alt=""/></div>
<map name="alocal__time_8h_a861e026d9803cb168d2a764f73ed9801_cgraph" id="alocal__time_8h_a861e026d9803cb168d2a764f73ed9801_cgraph">
<area shape="rect" title="Get the logical time us value. This is the corrected us value after synchronisation...." alt="" coords="5,5,142,31"/>
<area shape="rect" href="local__time_8c.html#a3de0db4d23103b2a5c83f9b27b39cf85" title=" " alt="" coords="190,5,347,31"/>
<area shape="poly" title=" " alt="" coords="142,16,174,16,174,21,142,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="local__time_8h_a861e026d9803cb168d2a764f73ed9801_icgraph.png" border="0" usemap="#alocal__time_8h_a861e026d9803cb168d2a764f73ed9801_icgraph" alt=""/></div>
<map name="alocal__time_8h_a861e026d9803cb168d2a764f73ed9801_icgraph" id="alocal__time_8h_a861e026d9803cb168d2a764f73ed9801_icgraph">
<area shape="rect" title="Get the logical time us value. This is the corrected us value after synchronisation...." alt="" coords="178,5,314,31"/>
<area shape="rect" href="local__time_8c.html#a1e5e7f4f074a146369ffa41864b51293" title="Convert a uint32_t timestamps into a uint64_t values. This should be used in the sink node...." alt="" coords="5,5,130,31"/>
<area shape="poly" title=" " alt="" coords="162,21,130,21,130,16,162,16"/>
</map>
</div>

</div>
</div>
<a id="a4ff48ea951750b142b77d3290b1fefa0" name="a4ff48ea951750b142b77d3290b1fefa0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ff48ea951750b142b77d3290b1fefa0">&#9670;&#160;</a></span>get_uptime_ticks_with_epoch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t get_uptime_ticks_with_epoch </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the uptime ticks with epoch value. This method concerns only the authority Role. This method will return the unix epoch timestamp based on the elapsed time (uptime - ref) and add the overall reference. </p>
<dl class="section return"><dt>Returns</dt><dd>int64_t </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00143">143</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  143</span>                                     {</div>
<div class="line"><span class="lineno">  144</span>    int64_t curent_uptime_ticks =  k_uptime_ticks();</div>
<div class="line"><span class="lineno">  145</span>    uint64_t ticks = 0;</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>    k_mutex_lock(&amp;<a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.mutex, K_FOREVER);</div>
<div class="line"><span class="lineno">  148</span>    {</div>
<div class="line"><span class="lineno">  149</span>        ticks = <a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.epoch_ref_ticks + (curent_uptime_ticks - <a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.uptime_ref_ticks);</div>
<div class="line"><span class="lineno">  150</span>    }</div>
<div class="line"><span class="lineno">  151</span>    k_mutex_unlock(&amp;<a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.mutex);</div>
<div class="line"><span class="lineno">  152</span>    <span class="keywordflow">return</span> ticks;</div>
<div class="line"><span class="lineno">  153</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.</p>

</div>
</div>
<a id="a129e568095d5d38c8bff447987d28132" name="a129e568095d5d38c8bff447987d28132"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a129e568095d5d38c8bff447987d28132">&#9670;&#160;</a></span>set_new_epoch_unix_ref()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_new_epoch_unix_ref </td>
          <td>(</td>
          <td class="paramtype">uint64_t</td>          <td class="paramname"><span class="paramname"><em>epoch_ref_us</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the new epoch unix ref value. Before the authority node starts a new network synchronisation, it should update the epoch reference. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">epoch_ref_ms</td><td></td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00112">112</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  112</span>                                                  {</div>
<div class="line"><span class="lineno">  113</span>    uint64_t epoch_ref_ticks = <a class="code hl_define" href="local__time_8c.html#a94f4c79dd9c3abcda2dc54bbe91dc99d">us_to_ticks</a>(epoch_ref_us);</div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>    k_mutex_lock(&amp;<a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.mutex, K_FOREVER);</div>
<div class="line"><span class="lineno">  116</span>    {</div>
<div class="line"><span class="lineno">  117</span>        <a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.uptime_ref_ticks = k_uptime_ticks();</div>
<div class="line"><span class="lineno">  118</span>        <a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.epoch_ref_ticks = epoch_ref_ticks;</div>
<div class="line"><span class="lineno">  119</span>        <a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.epoch_ref_us = epoch_ref_us;</div>
<div class="line"><span class="lineno">  120</span>        <a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.epoch_ref_valid = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  121</span>    }</div>
<div class="line"><span class="lineno">  122</span>    k_mutex_unlock(&amp;<a class="code hl_variable" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>.mutex);</div>
<div class="line"><span class="lineno">  123</span>}</div>
<div class="ttc" id="alocal__time_8c_html_a94f4c79dd9c3abcda2dc54bbe91dc99d"><div class="ttname"><a href="local__time_8c.html#a94f4c79dd9c3abcda2dc54bbe91dc99d">us_to_ticks</a></div><div class="ttdeci">#define us_to_ticks(us)</div><div class="ttdef"><b>Definition</b> <a href="local__time_8c_source.html#l00036">local_time.c:36</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structlocal__time.html#a739b69e5ab670b932fdd1989bd9a1249">local_time::epoch_ref_ticks</a>, <a class="el" href="structlocal__time.html#a8087194e952b0c5c19f22f8e461d579c">local_time::epoch_ref_us</a>, <a class="el" href="local__time_8c.html#aebe0d3778275cefebe36f5d35011bd93">local</a>, and <a class="el" href="local__time_8c.html#a94f4c79dd9c3abcda2dc54bbe91dc99d">us_to_ticks</a>.</p>

<p class="reference">Referenced by <a class="el" href="include_2bluesync_2bluesync_8h.html#a523e1397bf700b1ab25182c0db4017c6">bluesync_start_net_sync_with_unix_epoch_us()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="local__time_8h_a129e568095d5d38c8bff447987d28132_icgraph.png" border="0" usemap="#alocal__time_8h_a129e568095d5d38c8bff447987d28132_icgraph" alt=""/></div>
<map name="alocal__time_8h_a129e568095d5d38c8bff447987d28132_icgraph" id="alocal__time_8h_a129e568095d5d38c8bff447987d28132_icgraph">
<area shape="rect" title="Set the new epoch unix ref value. Before the authority node starts a new network synchronisation,..." alt="" coords="233,13,397,38"/>
<area shape="rect" href="bluesync_8c.html#a523e1397bf700b1ab25182c0db4017c6" title="Initiates a new BlueSync synchronization round as the time authority." alt="" coords="5,5,185,46"/>
<area shape="poly" title=" " alt="" coords="217,28,185,28,185,23,217,23"/>
</map>
</div>

</div>
</div>
<a id="a1e5e7f4f074a146369ffa41864b51293" name="a1e5e7f4f074a146369ffa41864b51293"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e5e7f4f074a146369ffa41864b51293">&#9670;&#160;</a></span>uncompress_time()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t uncompress_time </td>
          <td>(</td>
          <td class="paramtype">uint32_t</td>          <td class="paramname"><span class="paramname"><em>compress_32bit_timestamp</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert a uint32_t timestamps into a uint64_t values. This should be used in the sink node. In the Mesh network, pakcet payload is limited. Therefore only uint32_t timestamp can be used. When the sink received this kind of value, it can reconstruct the correct timestamps value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">compress_32bit_timestamp</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>uint64_t </dd></dl>

<p class="definition">Definition at line <a class="el" href="local__time_8c_source.html#l00163">163</a> of file <a class="el" href="local__time_8c_source.html">local_time.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  163</span>                                                           {</div>
<div class="line"><span class="lineno">  164</span>    uint64_t current_time_us = <a class="code hl_function" href="local__time_8c.html#a861e026d9803cb168d2a764f73ed9801">get_logical_time_us</a>();</div>
<div class="line"><span class="lineno">  165</span> </div>
<div class="line"><span class="lineno">  166</span>    uint64_t uncompressed_timestamp = (current_time_us &amp; 0xFFFFFFFF00000000ULL) | </div>
<div class="line"><span class="lineno">  167</span>                                      ((uint64_t) compress_32bit_timestamp &amp; 0x00000000FFFFFFFFULL);</div>
<div class="line"><span class="lineno">  168</span> </div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>    <span class="keywordflow">if</span> (uncompressed_timestamp &gt; current_time_us){</div>
<div class="line"><span class="lineno">  171</span>        uncompressed_timestamp -= 0x100000000ULL;</div>
<div class="line"><span class="lineno">  172</span>    }</div>
<div class="line"><span class="lineno">  173</span> </div>
<div class="line"><span class="lineno">  174</span>    <span class="keywordflow">return</span> uncompressed_timestamp;</div>
<div class="line"><span class="lineno">  175</span>}</div>
<div class="ttc" id="alocal__time_8c_html_a861e026d9803cb168d2a764f73ed9801"><div class="ttname"><a href="local__time_8c.html#a861e026d9803cb168d2a764f73ed9801">get_logical_time_us</a></div><div class="ttdeci">uint64_t get_logical_time_us(void)</div><div class="ttdoc">Get the logical time us value. This is the corrected us value after synchronisation....</div><div class="ttdef"><b>Definition</b> <a href="local__time_8c_source.html#l00092">local_time.c:92</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="local__time_8c.html#a861e026d9803cb168d2a764f73ed9801">get_logical_time_us()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="local__time_8h_a1e5e7f4f074a146369ffa41864b51293_cgraph.png" border="0" usemap="#alocal__time_8h_a1e5e7f4f074a146369ffa41864b51293_cgraph" alt=""/></div>
<map name="alocal__time_8h_a1e5e7f4f074a146369ffa41864b51293_cgraph" id="alocal__time_8h_a1e5e7f4f074a146369ffa41864b51293_cgraph">
<area shape="rect" title="Convert a uint32_t timestamps into a uint64_t values. This should be used in the sink node...." alt="" coords="5,5,130,31"/>
<area shape="rect" href="local__time_8c.html#a861e026d9803cb168d2a764f73ed9801" title="Get the logical time us value. This is the corrected us value after synchronisation...." alt="" coords="178,5,314,31"/>
<area shape="poly" title=" " alt="" coords="130,16,162,16,162,21,130,21"/>
<area shape="rect" href="local__time_8c.html#a3de0db4d23103b2a5c83f9b27b39cf85" title=" " alt="" coords="362,5,519,31"/>
<area shape="poly" title=" " alt="" coords="314,16,347,16,347,21,314,21"/>
</map>
</div>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2
</small></address>
</div><!-- doc-content -->
</body>
</html>
